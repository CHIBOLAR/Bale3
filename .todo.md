# Bale Inventory App Refactor - Task List

## Legend
- ‚úÖ Completed
- ‚è≥ In Progress
- ‚è∏Ô∏è Blocked/Waiting
- ‚ùå Cancelled
- üîÑ Needs Review
- ‚≠ï Not Started

---

## Phase 1: Authentication System Overhaul

### 1.1 Delete Demo System Files
- ‚úÖ Delete `app/actions/auth/demo-login.ts`
- ‚úÖ Delete `app/api/create-demo-account/route.ts`
- ‚úÖ Delete `lib/utils/demo-restrictions.ts`
- ‚úÖ Delete `scripts/seed-demo-data.ts`
- ‚úÖ Delete `components/DemoBanner.tsx`
- ‚úÖ Delete `app/dashboard/request-upgrade/` directory
- ‚úÖ Delete `app/api/upgrade-account/` directory
- ‚úÖ Delete `app/api/admin/approve-upgrade/` directory
- ‚úÖ Delete `app/api/admin/reject-upgrade/` directory
- ‚úÖ Delete `app/dashboard/admin/upgrade-requests/` directory

### 1.2 Delete Invite System Files
- ‚è≥ Delete `app/api/request-invite/` directory
- ‚è≥ Delete `app/api/admin/approve-invite/` directory
- ‚è≥ Delete `app/api/admin/reject-invite/` directory
- ‚è≥ Delete `app/dashboard/admin/invites/` directory
- ‚è≥ Find and delete `app/components/TryDemoButton.tsx` (or similar)

### 1.3 Configure Google OAuth
- ‚è≥ Set up Google OAuth in Google Cloud Console
- ‚è≥ Configure OAuth consent screen
- ‚è≥ Get Client ID and Client Secret
- ‚è≥ Add OAuth provider in Supabase dashboard
- ‚è≥ Configure redirect URLs (dev + production)
- ‚è≥ Add environment variables to `.env.local`
- ‚è≥ Add environment variables to Vercel

### 1.4 Create New Authentication Files
- ‚è≥ Create `app/(auth)/auth/callback/route.ts` - OAuth callback handler
- ‚è≥ Create `lib/auth/providers.ts` - Auth provider utilities
- ‚è≥ Create `lib/auth/google.ts` - Google OAuth helpers
- ‚è≥ Create `lib/auth/email-otp.ts` - Email OTP helpers

### 1.5 Rewrite Authentication Pages
- ‚è≥ Rewrite `app/(auth)/signup/page.tsx`
  - Add "Continue with Google" button (primary)
  - Add "Sign up with Email" button (secondary)
  - Remove invite code field
  - Add proper error handling
  - Add loading states
- ‚è≥ Rewrite `app/(auth)/login/page.tsx`
  - Add "Continue with Google" button (primary)
  - Add "Login with Email OTP" button (secondary)
  - Keep existing OTP flow
  - Add proper error handling
  - Add loading states
- ‚è≥ Update `app/(auth)/layout.tsx` if needed

### 1.6 Create Onboarding Wizard
- ‚è≥ Create `app/(auth)/onboarding/page.tsx`
- ‚è≥ Create `app/(auth)/onboarding/layout.tsx`
- ‚è≥ Create `components/onboarding/CompanySetupForm.tsx`
- ‚è≥ Create `components/onboarding/WarehouseSetupForm.tsx`
- ‚è≥ Create `app/actions/onboarding/setup-company.ts`
- ‚è≥ Add `onboarding_completed` check to middleware
- ‚è≥ Implement multi-step wizard UI
  - Step 1: Company name, industry
  - Step 2: Primary warehouse name, location
  - Step 3: Phone number (optional)
- ‚è≥ Add form validation
- ‚è≥ Create company on submit
- ‚è≥ Create first warehouse
- ‚è≥ Set user as Admin role
- ‚è≥ Mark onboarding as completed
- ‚è≥ Redirect to dashboard

### 1.7 Update Middleware
- ‚è≥ Open `middleware.ts`
- ‚è≥ Remove all demo-related checks
- ‚è≥ Remove invite code validation
- ‚è≥ Simplify to basic auth checks
- ‚è≥ Add onboarding redirect logic
- ‚è≥ Test middleware with new auth flow

### 1.8 Create Database Migration - Remove Demo System
- ‚è≥ Create `supabase/migrations/YYYYMMDDHHMMSS_remove_demo_system.sql`
- ‚è≥ Add SQL to drop `invites` table
- ‚è≥ Add SQL to drop `upgrade_requests` table
- ‚è≥ Add SQL to remove `is_demo` column from users
- ‚è≥ Add SQL to remove `invite_code` column from users
- ‚è≥ Add SQL to add `onboarding_completed` column to users
- ‚è≥ Test migration in local development
- ‚è≥ Run migration in production (with backup!)

### 1.9 Update Landing Page
- ‚è≥ Rewrite `app/page.tsx`
- ‚è≥ Remove all "Try Demo" buttons
- ‚è≥ Remove demo-related content
- ‚è≥ Update hero section with new CTAs
- ‚è≥ Add "Get Started with Google" primary CTA
- ‚è≥ Add "Sign in with Email" secondary CTA
- ‚è≥ Update "Request Access" section to "Get Started"
- ‚è≥ Remove upgrade request links
- ‚è≥ Test responsive design

### 1.10 Testing
- ‚è≥ Test Google OAuth signup flow
- ‚è≥ Test Email OTP signup flow
- ‚è≥ Test Google login flow
- ‚è≥ Test Email OTP login flow
- ‚è≥ Test onboarding wizard
- ‚è≥ Test session persistence
- ‚è≥ Test logout functionality
- ‚è≥ Test middleware redirects
- ‚è≥ Test mobile auth flows

---

## Phase 2: Performance Optimization

### 2.1 Create Database Indexes
- ‚è≥ Create `supabase/migrations/YYYYMMDDHHMMSS_add_performance_indexes.sql`
- ‚è≥ Add index on `products(company_id)`
- ‚è≥ Add index on `stock_units(company_id, warehouse_id)`
- ‚è≥ Add index on `stock_units(status)`
- ‚è≥ Add index on `goods_receipts(company_id, created_at DESC)`
- ‚è≥ Add index on `goods_dispatch(company_id, created_at DESC)`
- ‚è≥ Add index on `partners(company_id, partner_type)`
- ‚è≥ Add index on `sales_orders(company_id, status)`
- ‚è≥ Add composite index on `stock_units(product_id, warehouse_id, status)`
- ‚è≥ Test migration locally
- ‚è≥ Run migration in production

### 2.2 Implement Pagination System
- ‚è≥ Create `lib/pagination/config.ts` - Default page sizes, limits
- ‚è≥ Create `lib/pagination/utils.ts` - Pagination helper functions
- ‚è≥ Create `components/Pagination.tsx` - Reusable pagination component
  - Page number display
  - Previous/Next buttons
  - Items per page selector
  - Total count display
  - Jump to page input
- ‚è≥ Add URL search params handling for pagination
- ‚è≥ Test pagination component

### 2.3 Create Loading Components
- ‚è≥ Create `components/loading/SkeletonCard.tsx`
- ‚è≥ Create `components/loading/SkeletonTable.tsx`
- ‚è≥ Create `components/loading/SkeletonList.tsx`
- ‚è≥ Create `components/loading/PageLoader.tsx`
- ‚è≥ Create `components/loading/SpinnerButton.tsx`

### 2.4 Optimize Dashboard
- ‚è≥ Update `app/dashboard/page.tsx`
  - Add proper Suspense boundaries
  - Limit recent activities to 10 items
  - Use summary stats (not full datasets)
  - Implement parallel data fetching
  - Add loading skeletons
- ‚è≥ Update `app/actions/dashboard/data.ts`
  - Add query limits to functions
  - Optimize database queries
  - Select only needed columns
  - Add error handling
- ‚è≥ Test dashboard load time (target: < 1.5s)

### 2.5 Optimize Products List Page
- ‚è≥ Update `app/dashboard/products/page.tsx`
  - Add pagination with URL params
  - Add search functionality
  - Add filter dropdowns
  - Add sort options
  - Add loading skeleton
  - Select only needed columns
- ‚è≥ Update products query function
- ‚è≥ Test with large dataset (100+ products)
- ‚è≥ Verify load time < 1s

### 2.6 Optimize Stock Units Page
- ‚è≥ Update `app/dashboard/inventory/stock-units/page.tsx`
  - Add pagination
  - Add search by product/QR code
  - Add status filter
  - Add warehouse filter
  - Add date range filter
  - Add loading skeleton
- ‚è≥ Optimize stock units query
- ‚è≥ Test with large dataset (500+ units)

### 2.7 Optimize Goods Receipts Page
- ‚è≥ Update `app/dashboard/inventory/goods-receipts/page.tsx`
  - Add pagination
  - Add search by receipt number
  - Add date range filter
  - Add source type filter
  - Add loading skeleton
- ‚è≥ Optimize goods receipts query
- ‚è≥ Test with large dataset

### 2.8 Optimize Goods Dispatch Page
- ‚è≥ Update `app/dashboard/inventory/goods-dispatch/page.tsx`
  - Add pagination
  - Add search by dispatch number
  - Add date range filter
  - Add status filter
  - Add loading skeleton
- ‚è≥ Optimize goods dispatch query
- ‚è≥ Test with large dataset

### 2.9 Optimize Partners Page
- ‚è≥ Update `app/dashboard/partners/page.tsx`
  - Add pagination
  - Add search by name
  - Add partner type filter
  - Add loading skeleton
- ‚è≥ Optimize partners query
- ‚è≥ Test with large dataset

### 2.10 Optimize Sales Orders Page
- ‚è≥ Update `app/dashboard/sales-orders/page.tsx`
  - Add pagination
  - Add search by order number
  - Add date range filter
  - Add status filter
  - Add loading skeleton
- ‚è≥ Optimize sales orders query
- ‚è≥ Test with large dataset

### 2.11 Set Up React Query
- ‚è≥ Install `@tanstack/react-query`
- ‚è≥ Create `lib/react-query/provider.tsx`
- ‚è≥ Configure QueryClient with proper defaults
- ‚è≥ Create `lib/react-query/hooks.ts` - Custom hooks
- ‚è≥ Add QueryClientProvider to root layout
- ‚è≥ Implement cache invalidation strategy
- ‚è≥ Add optimistic updates for mutations

### 2.12 Image Optimization
- ‚è≥ Update `next.config.js` with image domains
- ‚è≥ Replace `<img>` tags with Next.js `<Image>` in:
  - Product images
  - Company logos
  - User avatars
  - Landing page images
- ‚è≥ Set up proper image formats (webp, avif)
- ‚è≥ Add responsive image sizes

### 2.13 Performance Testing
- ‚è≥ Measure dashboard load time
- ‚è≥ Measure list pages load time
- ‚è≥ Check Core Web Vitals
- ‚è≥ Test with large datasets
- ‚è≥ Test on slow 3G network
- ‚è≥ Test on mobile devices
- ‚è≥ Verify all targets met

---

## Phase 3: Goods Receipt Standardization

### 3.1 Define Standard Data Structure
- ‚è≥ Create `lib/types/goods-receipt.ts`
- ‚è≥ Define `StandardGoodsReceiptDisplay` interface
- ‚è≥ Define `GoodsReceiptListItem` interface
- ‚è≥ Define `GoodsReceiptDetailView` interface
- ‚è≥ Define transformation functions

### 3.2 Create Standard Components
- ‚è≥ Create `components/inventory/GoodsReceiptCard.tsx`
  - Receipt number
  - Date display
  - Supplier info
  - Items count
  - Total quantity
  - Status badge
  - Quick actions
- ‚è≥ Create `components/inventory/GoodsReceiptListItem.tsx`
  - Table row format
  - Consistent columns
  - Responsive design
- ‚è≥ Create `components/inventory/GoodsReceiptDetail.tsx`
  - Full receipt details
  - Item list with specs
  - Stock units created section
  - Timeline
  - Print button
  - Edit button

### 3.3 Create Centralized Queries
- ‚è≥ Create `lib/queries/goods-receipts.ts`
- ‚è≥ Implement `getGoodsReceipt(id)` with standard JOIN
- ‚è≥ Implement `getGoodsReceipts(companyId, options)` with pagination
- ‚è≥ Implement data transformation functions
- ‚è≥ Ensure consistent date formatting
- ‚è≥ Ensure consistent number formatting

### 3.4 Refactor Goods Receipts List Page
- ‚è≥ Update `app/dashboard/inventory/goods-receipts/page.tsx`
- ‚è≥ Use GoodsReceiptCard or GoodsReceiptListItem
- ‚è≥ Use centralized query functions
- ‚è≥ Ensure consistent display
- ‚è≥ Test with old and new receipts

### 3.5 Refactor Goods Receipt Detail Page
- ‚è≥ Update `app/dashboard/inventory/goods-receipts/[id]/page.tsx`
- ‚è≥ Use GoodsReceiptDetail component
- ‚è≥ Use centralized query
- ‚è≥ Ensure consistent display
- ‚è≥ Test with various receipt types

### 3.6 Refactor Goods Receipt Creation
- ‚è≥ Update `app/dashboard/inventory/goods-receipts/new/page.tsx`
- ‚è≥ Ensure creates standard format
- ‚è≥ Update form validation
- ‚è≥ Update server action
- ‚è≥ Test creation flow

### 3.7 Update Server Actions
- ‚è≥ Update `app/actions/inventory/goods-receipts.ts`
- ‚è≥ Use centralized queries
- ‚è≥ Ensure standard data format
- ‚è≥ Add proper error handling

### 3.8 Testing
- ‚è≥ Test goods receipt list display
- ‚è≥ Test goods receipt detail display
- ‚è≥ Test goods receipt creation
- ‚è≥ Verify consistency across all views
- ‚è≥ Test with different source types
- ‚è≥ Test print functionality

---

## Phase 4: UI/UX Improvements

### 4.1 Redesign Landing Page
- ‚è≥ Complete rewrite of `app/page.tsx`
- ‚è≥ New hero section with clear value proposition
- ‚è≥ Update CTAs (Google OAuth + Email OTP)
- ‚è≥ Remove all demo content
- ‚è≥ Add feature showcase
- ‚è≥ Add testimonials (optional)
- ‚è≥ Add pricing section (optional)
- ‚è≥ Update footer
- ‚è≥ Test responsive design
- ‚è≥ Test all links

### 4.2 Remove Demo UI Elements
- ‚è≥ Search codebase for "demo" (case-insensitive)
- ‚è≥ Remove from `app/dashboard/layout.tsx`
- ‚è≥ Remove from all feature pages
- ‚è≥ Remove "Demo Mode" badges
- ‚è≥ Remove "Upgrade Account" buttons
- ‚è≥ Remove demo restrictions display
- ‚è≥ Remove account type indicators
- ‚è≥ Remove demo limits display (e.g., "3/5 products")

### 4.3 Improve Dashboard Navigation
- ‚è≥ Update `components/DashboardNav.tsx`
- ‚è≥ Group menu items logically
- ‚è≥ Add icons to all items (if missing)
- ‚è≥ Improve active state indication
- ‚è≥ Improve mobile menu
- ‚è≥ Add keyboard shortcuts (optional)
- ‚è≥ Test navigation on mobile

### 4.4 Add Breadcrumbs
- ‚è≥ Create `components/Breadcrumbs.tsx`
- ‚è≥ Implement dynamic breadcrumb logic
- ‚è≥ Add to `app/dashboard/layout.tsx`
- ‚è≥ Test on various pages
- ‚è≥ Test on mobile

### 4.5 Improve Loading States
- ‚è≥ Add loading skeletons to dashboard
- ‚è≥ Add loading skeletons to all list pages
- ‚è≥ Add loading skeletons to detail pages
- ‚è≥ Add loading spinners to forms
- ‚è≥ Add loading states to buttons
- ‚è≥ Test all loading states

### 4.6 Improve Mobile Responsiveness
- ‚è≥ Test all pages on mobile
- ‚è≥ Fix any layout issues
- ‚è≥ Improve table responsiveness
- ‚è≥ Improve form responsiveness
- ‚è≥ Test on various screen sizes

---

## Phase 5: Backend Cleanup

### 5.1 Remove Demo Logic from Server Actions
- ‚è≥ Search for `is_demo` in codebase
- ‚è≥ Search for `isDemoUser` in codebase
- ‚è≥ Search for `checkDemoRestriction` in codebase
- ‚è≥ Remove demo checks from:
  - `app/actions/products/*.ts`
  - `app/actions/inventory/*.ts`
  - `app/actions/partners/*.ts`
  - `app/actions/sales/*.ts`
  - `app/actions/warehouse/*.ts`
  - `app/actions/staff/*.ts`

### 5.2 Remove Demo Constants
- ‚è≥ Search for `MAX_PRODUCTS`
- ‚è≥ Search for `MAX_PARTNERS`
- ‚è≥ Search for `MAX_SALES_ORDERS`
- ‚è≥ Search for `MAX_GOODS_RECEIPTS`
- ‚è≥ Search for `MAX_GOODS_DISPATCHES`
- ‚è≥ Remove all demo restriction constants

### 5.3 Clean Up API Routes
- ‚è≥ Review all API routes in `app/api/`
- ‚è≥ Remove demo-related logic
- ‚è≥ Remove invite-related routes (already deleted)
- ‚è≥ Remove upgrade-related routes (already deleted)
- ‚è≥ Add proper error handling
- ‚è≥ Add proper logging

### 5.4 Consolidate Duplicate Code
- ‚è≥ Identify common patterns
- ‚è≥ Extract form validation to `lib/validation/`
- ‚è≥ Extract data formatting to `lib/formatters/`
- ‚è≥ Extract common queries to `lib/queries/`
- ‚è≥ Extract reusable hooks to `lib/hooks/`

### 5.5 TypeScript Improvements
- ‚è≥ Generate types from Supabase schema
- ‚è≥ Create `lib/types/database.ts`
- ‚è≥ Create `lib/types/api.ts`
- ‚è≥ Create `lib/types/forms.ts`
- ‚è≥ Fix all `any` types
- ‚è≥ Add proper type exports
- ‚è≥ Run TypeScript compiler, fix errors

### 5.6 Error Handling
- ‚è≥ Create `lib/errors/handler.ts`
- ‚è≥ Create `lib/errors/types.ts`
- ‚è≥ Standardize error messages
- ‚è≥ Add error logging
- ‚è≥ Create error boundaries
- ‚è≥ Test error handling

### 5.7 Add Logging
- ‚è≥ Set up logging utility
- ‚è≥ Add logging to critical operations
- ‚è≥ Add performance logging
- ‚è≥ Add error logging
- ‚è≥ Test logging in production

---

## Phase 6: Testing & Validation

### 6.1 Authentication Testing
- ‚è≥ Test Google OAuth signup on desktop
- ‚è≥ Test Google OAuth signup on mobile
- ‚è≥ Test Email OTP signup on desktop
- ‚è≥ Test Email OTP signup on mobile
- ‚è≥ Test Google login on desktop
- ‚è≥ Test Google login on mobile
- ‚è≥ Test Email OTP login on desktop
- ‚è≥ Test Email OTP login on mobile
- ‚è≥ Test onboarding wizard
- ‚è≥ Test session persistence
- ‚è≥ Test logout functionality
- ‚è≥ Test auth redirects
- ‚è≥ Test protected routes

### 6.2 Performance Testing
- ‚è≥ Measure dashboard load time
- ‚è≥ Measure products page load time
- ‚è≥ Measure inventory pages load time
- ‚è≥ Measure partners page load time
- ‚è≥ Measure sales orders page load time
- ‚è≥ Test with 100+ products
- ‚è≥ Test with 500+ stock units
- ‚è≥ Test with 50+ goods receipts
- ‚è≥ Check Core Web Vitals (LCP, FID, CLS)
- ‚è≥ Test on slow 3G network
- ‚è≥ Test on various devices
- ‚è≥ Verify all performance targets met

### 6.3 Feature Testing
- ‚è≥ Test create product
- ‚è≥ Test edit product
- ‚è≥ Test delete product
- ‚è≥ Test create partner
- ‚è≥ Test edit partner
- ‚è≥ Test delete partner
- ‚è≥ Test create goods receipt
- ‚è≥ Test view goods receipt
- ‚è≥ Test create goods dispatch
- ‚è≥ Test view goods dispatch
- ‚è≥ Test create sales order
- ‚è≥ Test view sales order
- ‚è≥ Test QR code generation
- ‚è≥ Test QR code scanning
- ‚è≥ Test warehouse switching
- ‚è≥ Test staff management
- ‚è≥ Test all pagination
- ‚è≥ Test all search/filters
- ‚è≥ Test all sort options

### 6.4 UI/UX Testing
- ‚è≥ Test landing page on desktop
- ‚è≥ Test landing page on mobile
- ‚è≥ Test dashboard on desktop
- ‚è≥ Test dashboard on mobile
- ‚è≥ Test all pages on mobile
- ‚è≥ Test breadcrumbs
- ‚è≥ Test navigation
- ‚è≥ Test loading states
- ‚è≥ Test error states
- ‚è≥ Verify no demo UI elements remain

### 6.5 Database Testing
- ‚è≥ Verify migrations ran successfully
- ‚è≥ Verify indexes created
- ‚è≥ Verify demo tables dropped
- ‚è≥ Verify demo columns removed
- ‚è≥ Test RLS policies
- ‚è≥ Test multi-tenancy isolation
- ‚è≥ Test data integrity

### 6.6 Bug Fixes
- ‚è≥ Create list of bugs found
- ‚è≥ Prioritize bugs
- ‚è≥ Fix critical bugs
- ‚è≥ Fix high-priority bugs
- ‚è≥ Fix medium-priority bugs
- ‚è≥ Retest after fixes

### 6.7 Code Quality
- ‚è≥ Run TypeScript compiler
- ‚è≥ Fix all TypeScript errors
- ‚è≥ Run ESLint
- ‚è≥ Fix linting issues
- ‚è≥ Run Prettier
- ‚è≥ Format code
- ‚è≥ Review code for dead code
- ‚è≥ Remove unused imports
- ‚è≥ Remove commented code

---

## Phase 7: Documentation & Deployment

### 7.1 Update Documentation
- ‚è≥ Update README.md
- ‚è≥ Document new auth flow
- ‚è≥ Document environment variables
- ‚è≥ Document database schema changes
- ‚è≥ Document API changes
- ‚è≥ Create deployment guide
- ‚è≥ Create user guide (optional)

### 7.2 Pre-Deployment Checklist
- ‚è≥ Backup production database
- ‚è≥ Test migrations in staging
- ‚è≥ Update environment variables in Vercel
- ‚è≥ Verify Google OAuth credentials
- ‚è≥ Verify Resend API limits
- ‚è≥ Review security settings
- ‚è≥ Test rollback procedure
- ‚è≥ Prepare monitoring

### 7.3 Deployment
- ‚è≥ Create branch: `refactor/remove-demo-and-optimize`
- ‚è≥ Commit all changes
- ‚è≥ Push to GitHub
- ‚è≥ Create pull request
- ‚è≥ Review code changes
- ‚è≥ Deploy to Vercel preview
- ‚è≥ Test preview deployment thoroughly
- ‚è≥ Run migrations in production database
- ‚è≥ Merge to main
- ‚è≥ Deploy to production
- ‚è≥ Verify production deployment
- ‚è≥ Monitor for errors

### 7.4 Post-Deployment
- ‚è≥ Monitor application logs
- ‚è≥ Monitor error rates
- ‚è≥ Monitor performance metrics
- ‚è≥ Check user feedback
- ‚è≥ Fix any critical issues
- ‚è≥ Create issues for future improvements

---

## Notes & Blockers

### Current Blockers
- None

### Important Notes
- No demo users exist, full freedom to refactor
- App is live on Vercel, test thoroughly before deploying
- Backup database before running migrations
- Google OAuth requires domain verification
- Test on multiple devices and browsers

### Questions for User
- None currently

---

**Last Updated:** 2025-10-23
**Current Phase:** Phase 1 - Authentication System Overhaul
**Current Task:** Deleting demo system files (in progress)
