# Bale Inventory App - Complete Refactor Project

## Project Overview
This is a comprehensive refactor of the Bale Inventory management application to transform it from a demo-heavy prototype into a production-ready SaaS application.

## Current Status
**Branch:** main
**Deployment:** Vercel (Production)
**Database:** Supabase PostgreSQL

## Refactor Goals

### üéØ Primary Objectives
1. **Remove Demo Account System** - Eliminate all demo account logic, files, and UI elements
2. **Implement Modern Authentication** - Add Google OAuth + Email OTP as login/signup options
3. **Optimize Performance** - Fix slow loading on dashboard and list pages
4. **Standardize Goods Receipts** - Ensure consistent display and data structure across all goods receipt views
5. **Clean Up Codebase** - Remove dead code, improve TypeScript types, consolidate duplicates

### üö´ What We're Removing
- Demo account login (`demo@bale.inventory`)
- Demo restrictions (max products, partners, etc.)
- Demo banners and UI indicators
- Invite-based signup system
- Upgrade request system
- All demo-related API routes and server actions

### ‚úÖ What We're Adding
- Google OAuth authentication (signup + login)
- Email OTP authentication (signup + login)
- Company onboarding wizard for new users
- Pagination system for all list pages
- Database indexes for performance
- React Query for client-side caching
- Standard goods receipt components
- Proper loading states throughout the app

## Tech Stack
- **Frontend:** Next.js 15 (App Router), React 19, TypeScript, Tailwind CSS
- **Backend:** Supabase (PostgreSQL, Auth, Storage)
- **Authentication:** Supabase Auth with Google OAuth + Email OTP
- **Deployment:** Vercel
- **Email:** Resend API

## Phase Breakdown

### Phase 1: Authentication System Overhaul
**Goal:** Remove demo system and implement proper auth

#### Tasks:
1. ‚úÖ Delete all demo-related files
2. ‚è≥ Delete all invite/upgrade system files
3. ‚è≥ Configure Google OAuth in Supabase dashboard
4. ‚è≥ Create new signup page with Google + Email OTP options
5. ‚è≥ Create new login page with Google + Email OTP options
6. ‚è≥ Create OAuth callback handler (`app/(auth)/auth/callback/route.ts`)
7. ‚è≥ Build company onboarding wizard
8. ‚è≥ Create database migration to remove demo tables
9. ‚è≥ Update middleware to remove demo logic
10. ‚è≥ Test authentication flows

**Files to Delete:**
- ‚úÖ `app/actions/auth/demo-login.ts`
- ‚úÖ `app/api/create-demo-account/route.ts`
- ‚úÖ `lib/utils/demo-restrictions.ts`
- ‚úÖ `scripts/seed-demo-data.ts`
- ‚úÖ `components/DemoBanner.tsx`
- ‚úÖ `app/dashboard/request-upgrade/` (directory)
- ‚úÖ `app/api/upgrade-account/` (directory)
- ‚úÖ `app/api/admin/approve-upgrade/` (directory)
- ‚úÖ `app/api/admin/reject-upgrade/` (directory)
- ‚úÖ `app/dashboard/admin/upgrade-requests/` (directory)
- ‚è≥ `app/(auth)/signup/page.tsx` (will be rewritten)
- ‚è≥ `app/api/request-invite/` (directory)
- ‚è≥ `app/api/admin/approve-invite/` (directory)
- ‚è≥ `app/api/admin/reject-invite/` (directory)
- ‚è≥ `app/dashboard/admin/invites/` (directory)
- ‚è≥ `app/components/TryDemoButton.tsx`

**Files to Create:**
- `app/(auth)/auth/callback/route.ts` - OAuth callback handler
- `app/(auth)/onboarding/page.tsx` - Company setup wizard
- `lib/auth/providers.ts` - Centralized auth provider logic
- `supabase/migrations/YYYYMMDDHHMMSS_remove_demo_system.sql`

**Files to Rewrite:**
- `app/page.tsx` - Landing page (remove demo content)
- `app/(auth)/signup/page.tsx` - New signup with Google + Email
- `app/(auth)/login/page.tsx` - New login with Google + Email
- `middleware.ts` - Simplify auth checks

### Phase 2: Performance Optimization
**Goal:** Fix slow loading pages and optimize queries

#### Performance Targets:
- Dashboard load time: < 1.5 seconds
- List pages load time: < 1 second
- First contentful paint: < 0.8 seconds

#### Tasks:
1. ‚è≥ Create database indexes migration
2. ‚è≥ Implement pagination system and components
3. ‚è≥ Optimize dashboard queries (limit data fetching)
4. ‚è≥ Refactor products list page with pagination
5. ‚è≥ Refactor inventory/stock-units page with pagination
6. ‚è≥ Refactor goods receipts list page with pagination
7. ‚è≥ Refactor goods dispatch list page with pagination
8. ‚è≥ Refactor partners list page with pagination
9. ‚è≥ Refactor sales orders list page with pagination
10. ‚è≥ Install and configure React Query
11. ‚è≥ Add loading skeletons to all pages
12. ‚è≥ Optimize images with Next.js Image component

**Files to Create:**
- `supabase/migrations/YYYYMMDDHHMMSS_add_performance_indexes.sql`
- `lib/pagination/config.ts` - Pagination configuration
- `components/Pagination.tsx` - Reusable pagination component
- `components/loading/SkeletonCard.tsx`
- `components/loading/SkeletonTable.tsx`
- `components/loading/SkeletonList.tsx`
- `components/loading/PageLoader.tsx`
- `lib/react-query/provider.tsx`
- `lib/react-query/hooks.ts`

**Files to Optimize:**
- `app/dashboard/page.tsx` - Add limits, parallel fetching
- `app/actions/dashboard/data.ts` - Add query limits
- `app/dashboard/products/page.tsx` - Add pagination
- `app/dashboard/inventory/stock-units/page.tsx` - Add pagination
- `app/dashboard/inventory/goods-receipts/page.tsx` - Add pagination
- `app/dashboard/inventory/goods-dispatch/page.tsx` - Add pagination
- `app/dashboard/partners/page.tsx` - Add pagination
- `app/dashboard/sales-orders/page.tsx` - Add pagination

### Phase 3: Goods Receipt Standardization
**Goal:** Ensure consistent display and data structure

#### Tasks:
1. ‚è≥ Create standard TypeScript interface for goods receipts
2. ‚è≥ Create GoodsReceiptCard component
3. ‚è≥ Create GoodsReceiptListItem component
4. ‚è≥ Create GoodsReceiptDetail component
5. ‚è≥ Create centralized query functions
6. ‚è≥ Refactor goods receipts list page to use standard components
7. ‚è≥ Refactor goods receipt detail page to use standard components
8. ‚è≥ Ensure goods receipt creation follows standard format
9. ‚è≥ Test consistency across all views

**Files to Create:**
- `lib/types/goods-receipt.ts` - Standard data structure
- `components/inventory/GoodsReceiptCard.tsx`
- `components/inventory/GoodsReceiptListItem.tsx`
- `components/inventory/GoodsReceiptDetail.tsx`
- `lib/queries/goods-receipts.ts` - Centralized queries

**Files to Refactor:**
- `app/dashboard/inventory/goods-receipts/page.tsx`
- `app/dashboard/inventory/goods-receipts/GoodsReceiptsClient.tsx`
- `app/dashboard/inventory/goods-receipts/[id]/page.tsx`
- `app/dashboard/inventory/goods-receipts/new/page.tsx`
- `app/actions/inventory/goods-receipts.ts`

### Phase 4: UI/UX Improvements
**Goal:** Clean up UI and improve user experience

#### Tasks:
1. ‚è≥ Redesign landing page (remove demo content)
2. ‚è≥ Search and remove all demo UI elements from dashboard
3. ‚è≥ Remove demo restrictions display
4. ‚è≥ Remove account type indicators
5. ‚è≥ Improve DashboardNav component
6. ‚è≥ Create and add Breadcrumbs component
7. ‚è≥ Improve mobile responsiveness
8. ‚è≥ Add proper loading states throughout

**Files to Update:**
- `app/page.tsx` - Complete redesign
- `app/dashboard/layout.tsx` - Remove demo banner
- `components/DashboardNav.tsx` - Improve navigation
- All dashboard pages - Remove demo UI elements

**Files to Create:**
- `components/Breadcrumbs.tsx`

### Phase 5: Backend Cleanup
**Goal:** Remove demo logic and clean up code

#### Tasks:
1. ‚è≥ Search and remove all `is_demo` checks
2. ‚è≥ Remove demo restriction checks from server actions
3. ‚è≥ Remove MAX_PRODUCTS, MAX_PARTNERS constants
4. ‚è≥ Clean up API routes
5. ‚è≥ Consolidate duplicate code
6. ‚è≥ Fix TypeScript `any` types
7. ‚è≥ Improve error handling
8. ‚è≥ Add proper logging

**Database Cleanup:**
```sql
-- Tables to drop
DROP TABLE IF EXISTS invites CASCADE;
DROP TABLE IF EXISTS upgrade_requests CASCADE;

-- Columns to remove
ALTER TABLE users DROP COLUMN IF EXISTS is_demo;
ALTER TABLE users DROP COLUMN IF EXISTS invite_code;

-- Columns to add
ALTER TABLE users ADD COLUMN IF NOT EXISTS onboarding_completed BOOLEAN DEFAULT FALSE;
```

### Phase 6: Testing & Validation
**Goal:** Ensure everything works correctly

#### Tasks:
1. ‚è≥ Test Google OAuth signup
2. ‚è≥ Test Email OTP signup
3. ‚è≥ Test Google login
4. ‚è≥ Test Email OTP login
5. ‚è≥ Test onboarding wizard
6. ‚è≥ Test dashboard performance
7. ‚è≥ Test list pages performance
8. ‚è≥ Test pagination on all list pages
9. ‚è≥ Test goods receipt consistency
10. ‚è≥ Test all CRUD operations
11. ‚è≥ Test mobile responsiveness
12. ‚è≥ Load test with large datasets
13. ‚è≥ Fix bugs and issues
14. ‚è≥ Deploy to Vercel

## Implementation Timeline

### Week 1: Authentication Foundation
- Days 1-2: Remove demo system
- Days 3-4: Implement Google OAuth + Email OTP
- Days 5-7: Database updates and testing

### Week 2: Performance
- Days 1-3: Dashboard and list pages optimization
- Days 4-5: Caching and loading states
- Days 6-7: Query optimization

### Week 3: Standardization & UI
- Days 1-3: Goods receipt refactor
- Days 4-5: UI overhaul
- Days 6-7: Code cleanup

### Week 4: Testing & Launch
- Days 1-3: Comprehensive testing
- Days 4-5: Bug fixes
- Days 6-7: Documentation and deployment

## Important Notes

### ‚ö†Ô∏è Critical Considerations
1. **No Demo Users** - We have full freedom to refactor, no backwards compatibility needed
2. **Production Deployment** - App is live on Vercel, test thoroughly before deploying
3. **Data Safety** - Backup database before running migrations
4. **Google OAuth** - Requires domain verification in Google Console
5. **Environment Variables** - Need to add Google OAuth credentials
6. **Email Limits** - Ensure Resend API can handle OTP volume

### üîë Environment Variables Needed
```bash
# Existing
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
RESEND_API_KEY=

# New (to be added)
NEXT_PUBLIC_GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
```

### üìä Performance Metrics to Track
- Dashboard load time (target: < 1.5s)
- List pages load time (target: < 1s)
- First Contentful Paint (target: < 0.8s)
- Time to Interactive (target: < 2s)
- Largest Contentful Paint (target: < 2.5s)

### üß™ Testing Checklist
- [ ] Google OAuth signup works
- [ ] Email OTP signup works
- [ ] Google login works
- [ ] Email OTP login works
- [ ] Onboarding wizard creates company
- [ ] Dashboard loads quickly
- [ ] All list pages paginated
- [ ] Goods receipts display consistently
- [ ] Mobile responsive
- [ ] No demo-related code remains
- [ ] TypeScript compiles without errors
- [ ] All CRUD operations work
- [ ] RLS policies work correctly

## Git Strategy
Since this is a major refactor, consider:
1. Create a new branch: `refactor/remove-demo-and-optimize`
2. Make incremental commits for each phase
3. Test thoroughly before merging to main
4. Deploy to Vercel preview environment first
5. Test preview deployment
6. Merge to main and deploy to production

## Rollback Plan
1. Keep backup of current production database
2. Tag current main branch before merging refactor
3. Document all environment variable changes
4. Keep old migration files for reference
5. Test rollback procedure in development

## Resources
- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Next.js App Router](https://nextjs.org/docs/app)
- [React Query Documentation](https://tanstack.com/query/latest/docs/react/overview)
- [Tailwind CSS](https://tailwindcss.com/docs)

---

**Last Updated:** 2025-10-23
**Status:** Phase 1 In Progress - Demo files deleted, working on auth implementation
